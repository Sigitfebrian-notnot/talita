<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Flappy Bird Game</title>
  <style>
    body { margin: 0; overflow: hidden; }
    canvas { display: block; background: #70c5ce; }
  </style>
</head>
<body>
<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

// Responsive ukuran canvas
function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener("resize", resizeCanvas);
resizeCanvas();

// Game variables
let gameState = "menu"; 
let score = 0;
let gravity = 0.5;
let jump = -8;
let bird = { x: 50, y: canvas.height/2, width: 30, height: 30, velocity: 0 };
let pipes = [];
let pipeWidth = 50;
let pipeGap = 150;
let frame = 0;

// Reset game
function resetGame() {
  score = 0;
  bird.y = canvas.height/2;
  bird.velocity = 0;
  pipes = [];
  frame = 0;
}

// Level selector
function setLevel(level) {
  if (level === 1) { pipeGap = 150; gravity = 0.5; jump = -8; }
  if (level === 2) { pipeGap = 130; gravity = 0.6; jump = -8.5; }
  if (level === 3) { pipeGap = 110; gravity = 0.7; jump = -9; }
}

// Draw Bird
function drawBird() {
  ctx.fillStyle = "yellow";
  ctx.fillRect(bird.x, bird.y, bird.width, bird.height);
}

// Draw Pipes
function drawPipes() {
  ctx.fillStyle = "green";
  pipes.forEach(pipe => {
    ctx.fillRect(pipe.x, 0, pipeWidth, pipe.top);
    ctx.fillRect(pipe.x, pipe.bottom, pipeWidth, canvas.height - pipe.bottom);
  });
}

// Update game
function update() {
  if (gameState === "playing") {
    frame++;
    bird.velocity += gravity;
    bird.y += bird.velocity;

    if (frame % 100 === 0) {
      let top = Math.random() * (canvas.height - pipeGap - 100) + 50;
      let bottom = top + pipeGap;
      pipes.push({ x: canvas.width, top: top, bottom: bottom });
    }

    pipes.forEach(pipe => {
      pipe.x -= 3;
      if (pipe.x + pipeWidth === bird.x) score++;
    });

    // Collision
    for (let pipe of pipes) {
      if (
        bird.x < pipe.x + pipeWidth &&
        bird.x + bird.width > pipe.x &&
        (bird.y < pipe.top || bird.y + bird.height > pipe.bottom)
      ) {
        gameState = "gameover";
      }
    }

    if (bird.y + bird.height > canvas.height || bird.y < 0) {
      gameState = "gameover";
    }
  }
}

// Draw game
function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  if (gameState === "menu") {
    ctx.fillStyle = "black";
    ctx.font = "40px Arial";
    ctx.fillText("Flappy Bird", canvas.width/2 - 100, 150);
    ctx.font = "30px Arial";
    ctx.fillText("Play", canvas.width/2 - 50, 250);
    ctx.fillText("Select Level", canvas.width/2 - 80, 320);
    ctx.fillText("Instructions", canvas.width/2 - 90, 390);

  } else if (gameState === "level") {
    ctx.fillStyle = "black";
    ctx.font = "30px Arial";
    ctx.fillText("Level 1", canvas.width/2 - 50, 200);
    ctx.fillText("Level 2", canvas.width/2 - 50, 270);
    ctx.fillText("Level 3", canvas.width/2 - 50, 340);

  } else if (gameState === "instructions") {
    ctx.fillStyle = "black";
    ctx.font = "25px Arial";
    ctx.fillText("Tap layar (HP) atau tekan Spasi/Klik (PC) untuk lompat", 30, 200);
    ctx.fillText("Hindari pipa, dapatkan skor setinggi mungkin!", 30, 250);

  } else if (gameState === "playing") {
    drawBird();
    drawPipes();
    ctx.fillStyle = "black";
    ctx.font = "30px Arial";
    ctx.fillText("Score: " + score, 20, 40);

  } else if (gameState === "gameover") {
    ctx.fillStyle = "black";
    ctx.font = "40px Arial";
    ctx.fillText("Game Over", canvas.width/2 - 100, 200);
    ctx.font = "30px Arial";
    ctx.fillText("Score: " + score, canvas.width/2 - 50, 250);
    ctx.fillText("Tap layar / Klik / Spasi untuk Main Lagi", canvas.width/2 - 200, 320);
  }
}

// Controls PC (klik + keyboard)
canvas.addEventListener("click", handleInput);
document.addEventListener("keydown", (e) => {
  if (e.code === "Space") handleInput();
});

// Controls HP (tap layar)
canvas.addEventListener("touchstart", (e) => {
  e.preventDefault();
  handleInput(e.touches[0].clientX, e.touches[0].clientY);
});

// Input handler (gabungan PC & HP)
function handleInput(x=0, y=0) {
  if (gameState === "menu") {
    if (y >= 220 && y <= 270) { resetGame(); setLevel(1); gameState = "playing"; }
    else if (y >= 290 && y <= 340) { gameState = "level"; }
    else if (y >= 360 && y <= 410) { gameState = "instructions"; }

  } else if (gameState === "level") {
    if (y >= 170 && y <= 220) { resetGame(); setLevel(1); gameState = "playing"; }
    else if (y >= 240 && y <= 290) { resetGame(); setLevel(2); gameState = "playing"; }
    else if (y >= 310 && y <= 360) { resetGame(); setLevel(3); gameState = "playing"; }

  } else if (gameState === "instructions") {
    gameState = "menu";

  } else if (gameState === "playing") {
    bird.velocity = jump;

  } else if (gameState === "gameover") {
    resetGame();
    gameState = "menu";
  }
}

// Main loop
function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
