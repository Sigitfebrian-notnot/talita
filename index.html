<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Flappy Bird 3D Menu</title>
  <style>
    body { margin: 0; overflow: hidden; background: #000; }
    canvas { display: block; margin: auto; background: #70c5ce; }
  </style>
</head>
<body>
<canvas id="gameCanvas" width="320" height="480"></canvas>
<script>
  const canvas = document.getElementById("gameCanvas");
  const ctx = canvas.getContext("2d");

  let frames = 0;
  const DEGREE = Math.PI / 180;

  const sprite = new Image();
  sprite.src = "bird.png";
  const bg = new Image();
  bg.src = "background.png";
  const pipe = new Image();
  pipe.src = "pipe.png";

  let state = { current: 0, getReady: 0, game: 1, over: 2 };

  document.addEventListener("keydown", (e) => {
    if (e.code === "Space") {
      if (state.current === state.getReady) {
        state.current = state.game;
      } else if (state.current === state.game) {
        bird.flap();
      } else if (state.current === state.over) {
        state.current = state.getReady;
        bird.reset();
        pipes.reset();
      }
    }
  });

  canvas.addEventListener("touchstart", () => {
    if (state.current === state.getReady) {
      state.current = state.game;
    } else if (state.current === state.game) {
      bird.flap();
    } else if (state.current === state.over) {
      state.current = state.getReady;
      bird.reset();
      pipes.reset();
    }
  });

  const bird = {
    x: 50, y: 150, w: 34, h: 26,
    gravity: 0.25, jump: 4.6, speed: 0, rotation: 0,
    flap() { this.speed = -this.jump; },
    draw() {
      ctx.drawImage(sprite, this.x, this.y);
    },
    update() {
      if (state.current === state.getReady) {
        this.y = 150;
        this.rotation = 0 * DEGREE;
      } else {
        this.speed += this.gravity;
        this.y += this.speed;
        if (this.y + this.h >= canvas.height - 80) {
          this.y = canvas.height - 80 - this.h;
          if (state.current === state.game) {
            state.current = state.over;
          }
        }
      }
    },
    reset() {
      this.speed = 0;
      this.y = 150;
    }
  };

  const pipes = {
    position: [],
    top: { sX: 0, sY: 0 },
    bottom: { sX: 0, sY: 1 },
    w: 53, h: 400, gap: 85, maxYPos: -150,
    draw() {
      for (let i = 0; i < this.position.length; i++) {
        let p = this.position[i];
        let topYPos = p.y;
        ctx.drawImage(pipe, p.x, topYPos, this.w, this.h);
        ctx.drawImage(pipe, p.x, topYPos + this.h + this.gap, this.w, this.h);
      }
    },
    update() {
      if (state.current !== state.game) return;
      if (frames % 100 === 0) {
        this.position.push({ x: canvas.width, y: this.maxYPos * (Math.random() + 1) });
      }
      for (let i = 0; i < this.position.length; i++) {
        let p = this.position[i];
        p.x -= 2;
        if (p.x + this.w <= 0) {
          this.position.shift();
        }
      }
    },
    reset() { this.position = []; }
  };

  // ====== Tombol 3D ======
  function drawButton(text, w, y) {
    // bayangan (shadow)
    ctx.fillStyle = "rgba(0,0,0,0.4)";
    ctx.fillRect(canvas.width/2 - w/2 + 5, y + 5, w, 50);

    // body tombol dengan gradasi 3D
    const grad = ctx.createLinearGradient(0, y, 0, y + 50);
    grad.addColorStop(0, "#2ecc71");   // hijau terang
    grad.addColorStop(1, "#27ae60");   // hijau gelap
    ctx.fillStyle = grad;
    ctx.fillRect(canvas.width/2 - w/2, y, w, 50);

    // highlight atas biar timbul
    ctx.fillStyle = "rgba(255,255,255,0.3)";
    ctx.fillRect(canvas.width/2 - w/2, y, w, 5);

    // garis bawah (shadow dalam)
    ctx.fillStyle = "rgba(0,0,0,0.2)";
    ctx.fillRect(canvas.width/2 - w/2, y + 45, w, 5);

    // teks tombol
    ctx.fillStyle = "white";
    ctx.font = "20px Arial bold";
    ctx.fillText(text, canvas.width/2 - ctx.measureText(text).width/2, y + 32);
  }

  function draw() {
    ctx.drawImage(bg, 0, 0, canvas.width, canvas.height);

    if (state.current === state.getReady) {
      ctx.fillStyle = "white";
      ctx.font = "30px Arial bold";
      ctx.fillText("Flappy Bird", canvas.width/2 - 80, 100);

      drawButton("Play", 120, 200);
      drawButton("Exit", 120, 280);
    }

    if (state.current === state.game) {
      pipes.draw();
      bird.draw();
    }
    if (state.current === state.over) {
      ctx.fillStyle = "white";
      ctx.font = "25px Arial";
      ctx.fillText("Game Over", canvas.width/2 - 70, 200);
      drawButton("Restart", 140, 260);
    }
  }

  function update() {
    bird.update();
    pipes.update();
  }

  function loop() {
    update();
    draw();
    frames++;
    requestAnimationFrame(loop);
  }

  loop();
</script>
</body>
</html>
