<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Flappy Bird Game</title>
  <style>
    body { margin: 0; overflow: hidden; background: #87CEEB; }
    canvas { display: block; margin: auto; background: #87CEEB; }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>
  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    // Responsive canvas
    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    window.addEventListener("resize", resizeCanvas);
    resizeCanvas();

    // Load assets
    const bg = new Image();
    bg.src = "background.png";

    const birdImg = new Image();
    birdImg.src = "bird.png";

    let gameState = "menu"; // "menu", "level", "instructions", "playing", "gameover"
    let score = 0, level = 1;

    const bird = {
      x: 50, y: 150, width: 40, height: 40,
      gravity: 0.6, lift: -10, velocity: 0
    };

    const pipes = [];
    let pipeWidth = 60, pipeGap = 150, pipeSpeed = 2;

    function setLevel(lv) {
      level = lv;
      if (lv === 1) { pipeGap = 150; pipeSpeed = 2; }
      if (lv === 2) { pipeGap = 130; pipeSpeed = 3; }
      if (lv === 3) { pipeGap = 110; pipeSpeed = 4; }
      if (lv === 4) { pipeGap = 90;  pipeSpeed = 5; }
    }

    function resetGame() {
      score = 0;
      bird.y = 150; bird.velocity = 0;
      pipes.length = 0;
    }

    function drawMenu() {
      ctx.fillStyle = "black"; ctx.font = "40px Arial"; ctx.textAlign = "center";
      ctx.fillText("Flappy Bird", canvas.width / 2, 150);

      ctx.fillStyle = "green"; ctx.fillRect(canvas.width/2-100, 250, 200, 50);
      ctx.fillStyle = "white"; ctx.fillText("Play", canvas.width/2, 285);

      ctx.fillStyle = "blue"; ctx.fillRect(canvas.width/2-100, 320, 200, 50);
      ctx.fillStyle = "white"; ctx.fillText("Level Select", canvas.width/2, 355);

      ctx.fillStyle = "purple"; ctx.fillRect(canvas.width/2-100, 390, 200, 50);
      ctx.fillStyle = "white"; ctx.fillText("Instructions", canvas.width/2, 425);
    }

    function drawLevelMenu() {
      ctx.fillStyle = "black"; ctx.font = "30px Arial"; ctx.textAlign = "center";
      ctx.fillText("Select Level", canvas.width/2, 150);

      ["Level 1","Level 2","Level 3","Level 4"].forEach((txt,i)=>{
        ctx.fillStyle = "orange"; ctx.fillRect(canvas.width/2-100, 200+70*i, 200, 50);
        ctx.fillStyle = "white"; ctx.fillText(txt, canvas.width/2, 235+70*i);
      });
    }

    function drawInstructions() {
      ctx.fillStyle = "black"; ctx.font = "20px Arial"; ctx.textAlign = "center";
      ctx.fillText("Instructions:", canvas.width/2, 150);
      ctx.fillText("Press SPACE / CLICK / TAP to fly", canvas.width/2, 200);
      ctx.fillText("Avoid pipes to score points", canvas.width/2, 230);
      ctx.fillText("Back", canvas.width/2, canvas.height-70);
    }

    function drawGameover() {
      ctx.fillStyle = "red"; ctx.font = "40px Arial"; ctx.textAlign = "center";
      ctx.fillText("Game Over", canvas.width/2, 200);
      ctx.fillStyle = "black"; ctx.fillText("Score: "+score, canvas.width/2, 260);
      ctx.fillText("Back to Menu", canvas.width/2, canvas.height-70);
    }

    function drawBird() {
      if (birdImg.complete) ctx.drawImage(birdImg, bird.x, bird.y, bird.width, bird.height);
      else { ctx.fillStyle = "yellow"; ctx.fillRect(bird.x, bird.y, bird.width, bird.height); }
    }

    function drawPipes() {
      ctx.fillStyle = "green";
      pipes.forEach(pipe=>{
        ctx.fillRect(pipe.x, 0, pipeWidth, pipe.top);
        ctx.fillRect(pipe.x, canvas.height - pipe.bottom, pipeWidth, pipe.bottom);
      });
    }

    function updatePipes() {
      if (frames % 100 === 0) {
        let top = Math.random()*(canvas.height-pipeGap-100)+50;
        let bottom = canvas.height - (top+pipeGap);
        pipes.push({x:canvas.width, top:top, bottom:bottom});
      }
      pipes.forEach(pipe=>{
        pipe.x -= pipeSpeed;
        if (pipe.x+pipeWidth<0) {
          pipes.shift(); score++;
        }
      });
    }

    function detectCollision() {
      for (let pipe of pipes) {
        if (bird.x+bird.width>pipe.x && bird.x<pipe.x+pipeWidth) {
          if (bird.y<pipe.top || bird.y+bird.height>canvas.height-pipe.bottom) {
            gameState="gameover";
          }
        }
      }
      if (bird.y+bird.height>canvas.height || bird.y<0) gameState="gameover";
    }

    let frames=0;
    function loop() {
      ctx.drawImage(bg,0,0,canvas.width,canvas.height);
      if (gameState==="menu") drawMenu();
      else if (gameState==="level") drawLevelMenu();
      else if (gameState==="instructions") drawInstructions();
      else if (gameState==="gameover") drawGameover();
      else if (gameState==="playing") {
        frames++;
        bird.velocity+=bird.gravity; bird.y+=bird.velocity;
        updatePipes(); drawPipes(); detectCollision();
        drawBird();
        ctx.fillStyle="black"; ctx.font="20px Arial"; ctx.fillText("Score: "+score,50,30);
      }
      requestAnimationFrame(loop);
    }

    // === Kontrol PC (klik + spasi) ===
    canvas.addEventListener("click", e=>{
      const mx = e.clientX, my = e.clientY;
      if (gameState==="menu") {
        if (mx>=canvas.width/2-100 && mx<=canvas.width/2+100) {
          if (my>=250 && my<=300) { resetGame(); setLevel(1); gameState="playing"; }
          else if (my>=320 && my<=370) { gameState="level"; }
          else if (my>=390 && my<=440) { gameState="instructions"; }
        }
      } else if (gameState==="level") {
        if (mx>=canvas.width/2-100 && mx<=canvas.width/2+100) {
          if (my>=200 && my<=250) { resetGame(); setLevel(1); gameState="playing"; }
          else if (my>=270 && my<=320) { resetGame(); setLevel(2); gameState="playing"; }
          else if (my>=340 && my<=390) { resetGame(); setLevel(3); gameState="playing"; }
          else if (my>=410 && my<=460) { resetGame(); setLevel(4); gameState="playing"; }
        }
      } else if (gameState==="instructions"||gameState==="gameover") {
        if (mx>=canvas.width/2-100 && mx<=canvas.width/2+100 &&
            my>=canvas.height-100 && my<=canvas.height-50) gameState="menu";
      } else if (gameState==="playing") bird.velocity=bird.lift;
    });

    document.addEventListener("keydown",e=>{
      if(e.code==="Space"&&gameState==="playing") bird.velocity=bird.lift;
    });

    // === Kontrol HP (tap layar) ===
    canvas.addEventListener("touchstart", e=>{
      e.preventDefault();
      const touch = e.touches[0];
      const mx = touch.clientX, my = touch.clientY;
      if (gameState==="menu") {
        if (mx>=canvas.width/2-100 && mx<=canvas.width/2+100) {
          if (my>=250 && my<=300) { resetGame(); setLevel(1); gameState="playing"; }
          else if (my>=320 && my<=370) { gameState="level"; }
          else if (my>=390 && my<=440) { gameState="instructions"; }
        }
      } else if (gameState==="level") {
        if (mx>=canvas.width/2-100 && mx<=canvas.width/2+100) {
          if (my>=200 && my<=250) { resetGame(); setLevel(1); gameState="playing"; }
          else if (my>=270 && my<=320) { resetGame(); setLevel(2); gameState="playing"; }
          else if (my>=340 && my<=390) { resetGame(); setLevel(3); gameState="playing"; }
          else if (my>=410 && my<=460) { resetGame(); setLevel(4); gameState="playing"; }
        }
      } else if (gameState==="instructions"||gameState==="gameover") {
        if (mx>=canvas.width/2-100 && mx<=canvas.width/2+100 &&
            my>=canvas.height-100 && my<=canvas.height-50) gameState="menu";
      } else if (gameState==="playing") bird.velocity=bird.lift;
    });

    loop();
  </script>
</body>
</html>
