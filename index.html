<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Flappy Bird 3D</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: #70c5ce;
    }
    canvas {
      display: block;
    }
  </style>
</head>
<body>
<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

window.addEventListener("resize", () => {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
});

// ---------------- Game State ----------------
let gameState = "menu"; // "menu" | "play"

// ---------------- Menu Buttons ----------------
let buttons = [
  { text: "Start Game", x: canvas.width/2-100, y: 200, w: 200, h: 60,
    action: () => { gameState = "play"; } },
  { text: "Level", x: canvas.width/2-100, y: 280, w: 200, h: 60,
    action: () => { alert("Level select (belum dibuat)"); } },
  { text: "Instructions", x: canvas.width/2-100, y: 360, w: 200, h: 60,
    action: () => { alert("Tap layar / klik mouse untuk terbang"); } }
];

function drawButton(btn) {
  // bayangan
  ctx.fillStyle = "#333";
  ctx.fillRect(btn.x+4, btn.y+4, btn.w, btn.h);
  // gradient 3D
  let grad = ctx.createLinearGradient(btn.x, btn.y, btn.x, btn.y+btn.h);
  grad.addColorStop(0, "#4facfe");
  grad.addColorStop(1, "#00f2fe");
  ctx.fillStyle = grad;
  ctx.fillRect(btn.x, btn.y, btn.w, btn.h);
  // border
  ctx.strokeStyle = "#000";
  ctx.lineWidth = 2;
  ctx.strokeRect(btn.x, btn.y, btn.w, btn.h);
  // teks
  ctx.fillStyle = "white";
  ctx.font = "20px Arial";
  ctx.textAlign = "center";
  ctx.textBaseline = "middle";
  ctx.fillText(btn.text, btn.x+btn.w/2, btn.y+btn.h/2);
}

function drawMenu() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.fillStyle = "#87ceeb";
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  ctx.fillStyle = "white";
  ctx.font = "bold 40px Arial";
  ctx.textAlign = "center";
  ctx.fillText("Flappy Bird 3D", canvas.width/2, 120);

  buttons.forEach(drawButton);
}

// klik / tap menu
canvas.addEventListener("click", function(e) {
  if (gameState === "menu") {
    let rect = canvas.getBoundingClientRect();
    let mx = e.clientX - rect.left;
    let my = e.clientY - rect.top;
    buttons.forEach(btn => {
      if (mx > btn.x && mx < btn.x+btn.w && my > btn.y && my < btn.y+btn.h) {
        btn.action();
      }
    });
  }
});

// ---------------- Game Variables ----------------
let birdX = 50;
let birdY = 150;
let birdRadius = 20;
let gravity = 0.6;
let lift = -10;
let velocity = 0;

let pipes = [];
let frame = 0;
let score = 0;

// ---------------- Game Functions ----------------
function drawBird() {
  ctx.beginPath();
  ctx.arc(birdX, birdY, birdRadius, 0, Math.PI*2);
  ctx.fillStyle = "yellow";
  ctx.fill();
  ctx.stroke();
}

function drawPipes() {
  ctx.fillStyle = "green";
  pipes.forEach(pipe => {
    ctx.fillRect(pipe.x, 0, pipe.width, pipe.top);
    ctx.fillRect(pipe.x, canvas.height - pipe.bottom, pipe.width, pipe.bottom);
  });
}

function updatePipes() {
  if (frame % 90 === 0) {
    let pipeHeight = Math.floor(Math.random() * (canvas.height/2)) + 50;
    let gap = 150;
    pipes.push({
      x: canvas.width,
      width: 50,
      top: pipeHeight,
      bottom: canvas.height - pipeHeight - gap
    });
  }

  pipes.forEach(pipe => {
    pipe.x -= 2;
  });

  if (pipes.length > 0 && pipes[0].x + pipes[0].width < 0) {
    pipes.shift();
    score++;
  }
}

function checkCollision() {
  if (birdY + birdRadius > canvas.height || birdY - birdRadius < 0) {
    resetGame();
  }

  pipes.forEach(pipe => {
    if (birdX + birdRadius > pipe.x && birdX - birdRadius < pipe.x + pipe.width) {
      if (birdY - birdRadius < pipe.top || birdY + birdRadius > canvas.height - pipe.bottom) {
        resetGame();
      }
    }
  });
}

function resetGame() {
  birdY = 150;
  velocity = 0;
  pipes = [];
  score = 0;
  gameState = "menu"; // balik ke menu lagi
}

function updateGame() {
  velocity += gravity;
  birdY += velocity;

  updatePipes();
  checkCollision();
}

function drawGame() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle = "#70c5ce";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  drawBird();
  drawPipes();

  ctx.fillStyle = "white";
  ctx.font = "24px Arial";
  ctx.fillText("Score: " + score, 60, 30);
}

// ---------------- Controls ----------------
document.addEventListener("keydown", function(e) {
  if (e.code === "Space") {
    velocity = lift;
  }
});
canvas.addEventListener("click", function(e) {
  if (gameState === "play") {
    velocity = lift;
  }
});
canvas.addEventListener("touchstart", function(e) {
  if (gameState === "play") {
    velocity = lift;
  }
});

// ---------------- Game Loop ----------------
function gameLoop() {
  if (gameState === "menu") {
    drawMenu();
  } else if (gameState === "play") {
    updateGame();
    drawGame();
  }
  requestAnimationFrame(gameLoop);
}
gameLoop();
</script>
</body>
</html>
